:: Change passwords (Administrator & scored users)
cmd> net user Administrator *
cmd> net user <username> *

:: Note: Make sure to change password in the scoring engine whenever scored user password is changed

:: Rename administrator account
cmd> wmic useraccount where “name='Administrator'” rename pickle

:: Add backup admin account
cmd> net user /add cucumber [password]
cmd> net localgroup Administrators cucumber /add

:: Disable or remove unneeded users (Guest, WDAGUtilityAccount, krbtgt, DefaultAccount - should all be disabled)
cmd> net user <username> /active:no
cmd> net user <username> /delete

:: Create directory for downloads
cmd> mkdir "C:\Program Files\WindowsPowershell\pickles"

:: Install Sysinternals Suite
ps> (New-Object System.Net.WebClient).DownloadFile(“https://download.sysinternals.com/files/SysinternalsSuite.zip”, “C:\Program Files\WindowsPowershell\pickles\sysinternals.zip”)
cmd> wget -o sysinternals.zip https://download.sysinternals.com/files/SysinternalsSuite.zip
ps> Expand-Archive -LiteralPath sysinternals.zip -DestinationPath sysinternals

::Links for Sysinternals tools we actually use
https://live.sysinternals.com/autoruns.exe
https://download.sysinternals.com/files/Autoruns.zip

https://download.sysinternals.com/files/ListDlls.zip

https://live.sysinternals.com/procexp.exe
https://download.sysinternals.com/files/ProcessExplorer.zip

https://live.sysinternals.com/Procmon.exe
https://download.sysinternals.com/files/ProcessMonitor.zip

https://live.sysinternals.com/Tcpview.exe
https://download.sysinternals.com/files/TCPView.zip

https://download.sysinternals.com/files/Sigcheck.zip

https://download.sysinternals.com/files/Sysmon.zip

:: Install Explorer++ (for windows core boxes)
ps> (New-Object System.Net.WebClient).DownloadFile(“https://explorerplusplus.com/software/explorer++_1.3.5_x64.zip”, “C:\Program Files\WindowsPowershell\pickles\explorerplusplus.zip”)
cmd> wget -o explorerplusplus.zip https://explorerplusplus.com/software/explorer++_1.3.5_x64.zip
ps> Expand-Archive -LiteralPath explorerplusplus.zip -DestinationPath explorerplusplus

:: Install Wireshark
ps> (New-Object System.Net.WebClient).DownloadFile(“https://2.na.dl.wireshark.org/win64/Wireshark-win64-3.6.2.exe”, “C:\Program Files\WindowsPowershell\pickles\wireshark.exe”)
cmd> wget -o wireshark.exe https://2.na.dl.wireshark.org/win64/Wireshark-win64-3.6.2.exe

:: Install Windows Firewall Control 
ps> (New-Object System.Net.WebClient).DownloadFile(“https://www.binisoft.org/download/wfc6setup.exe”, “C:\Program Files\WindowsPowershell\pickles\winfwctrl.exe”)
cmd> wget -o winfwctrl.exe https://www.binisoft.org/download/wfc6setup.exe

:: Run firewall script
cmd> .\firewall.bat

:: Open Windows Firewall Control
cmd> .\winfwctrl.exe

:: Lock windows firewall control with password
:: Only allow rules created through windows firewall control

:: Audit Host Information
cmd> .\information.bat

:: Backups (add more)
:: DNS
cmd> xcopy /E /I C:\Windows\System32\dns "C:\Program Files\WindowsPowershell\picklestuff\dns"
:: IIS
cmd> xcopy /E /I C:\inetpub\wwwroot "C:\Program Files\WindowsPowershell\picklestuff\iis"

:: Sysmon Setup (choose one of the two configs, first one is more comprehensive)
ps> (New-Object System.Net.WebClient).DownloadFile(“https://raw.githubusercontent.com/olafhartong/sysmon-modular/master/sysmonconfig.xml”, “C:\Program Files\WindowsPowershell\pickles\sysmonconfig.xml”)
ps> (New-Object System.Net.WebClient).DownloadFile(“https://raw.githubusercontent.com/SwiftOnSecurity/sysmon-config/master/sysmonconfig-export.xml”, “C:\Program Files\WindowsPowershell\pickles\sysmonconfig.xml”)
cmd> wget -o sysmonconfig.xml https://raw.githubusercontent.com/olafhartong/sysmon-modular/master/sysmonconfig.xml
cmd> wget -o sysmonconfig.xml https://raw.githubusercontent.com/SwiftOnSecurity/sysmon-config/master/sysmonconfig-export.xml

cmd> .\sysmon.exe -i sysmonconfig.xml

:: Logs are located in Event Viewer under Applications and Services Log > Microsoft > Windows > Sysmon > Operational
:: https://www.blackhillsinfosec.com/a-sysmon-event-id-breakdown/ 

:: Audit Network Services
cmd> net start
cmd> net stop <service_name>

:: Audit Running Processes
cmd> tasklist /svc /FO table
cmd> taskkill /im <process_name> /f

:: Audit scheduled tasks
ps> get-scheduledtask
cmd> schtasks /query
cmd> schtasks /delete /tn *

:: Use sysinternals autoruns.exe (boot safe mode to possibly see hidden things), procexp.exe and procmon.exe

:: Netstat Audit
cmd> netstat
cmd> netstat -ab 
cmd> netstat -ano
cmd> netstat -ano | findstr LIST | findstr /V ::1 | findstr /V 127.0.0.1

:: Enable Logging
:: DNS server
ps> dnscmd /config /loglevel 0x8000F301
ps> dnscmd /config /logfilemaxsize 0xC800000
:: Powershell 
cmd> mkdir C:\scrips
cmd> reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ModuleLogging" /v EnableModuleLogging /t REG_DWORD /d 1 /f
cmd> reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ModuleLogging\ModuleNames" /v * /t REG_SZ /d * /f
cmd> reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging" /v EnableScriptBlockLogging /t REG_DWORD /d 1 /f
cmd> reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\Transcription" /v EnableTranscripting /t REG_DWORD /d 1 /f
cmd> reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\Transcription" /v OutputDirectory /t REG_SZ /d C:\scrips /f

:: Privileges for cmd and powershell
:: Take ownership of executables
cmd> takeown /f C:\Windows\System32\cmd.exe
cmd> takeown /f C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe

:: Backup & Restore file/folder permissions
cmd> icacls c:\Windows\System32\cmd.exe /save c:\Program Files\WindowsPowershell\picklestuff\cmdacl /T
cmd> icacls c:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /save c:\Program Files\WindowsPowershell\picklestuff\psacl /T
cmd> icacls c:\Windows\System32\cmd.exe /restore c:\Program Files\WindowsPowershell\picklestuff\cmdacl
cmd> icacls c:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /restore c:\Program Files\WindowsPowershell\picklestuff\psacl

:: Grant one admin account permissions
cmd> icacls C:\Windows\System32\cmd.exe /grant pickle:F
cmd> icacls C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /grant pickle:F

:: Disable inheritance
cmd> icacls C:\Windows\System32\cmd.exe /inheritance:d
cmd> icacls C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /inheritance:d

:: Remove all permissions except one admin account
cmd> icacls C:\Windows\System32\cmd.exe /remove Users
cmd> icacls C:\Windows\System32\cmd.exe /remove Administrators
cmd> icacls C:\Windows\System32\cmd.exe /remove SYSTEM 
cmd> icacls C:\Windows\System32\cmd.exe /remove "ALL APPLICATION PACKAGES"
cmd> icacls C:\Windows\System32\cmd.exe /remove "ALL RESTRICTED APPLICATION PACKAGES"

cmd> icacls C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /remove Users
cmd> icacls C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /remove Administrators
cmd> icacls C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /remove SYSTEM 
cmd> icacls C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /remove "ALL APPLICATION PACKAGES"
cmd> icacls C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /remove "ALL RESTRICTED APPLICATION PACKAGES"
cmd> icacls C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /remove TrustedInstaller

:: Experiment with resetting permissions (might cause problems on core?)
cmd> icacls C:\Windows\System32\cmd.exe /q /c /reset
cmd> icacls C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe /q /c /reset

:: Check for Windows Defender file exclusions

:: Check for implants
